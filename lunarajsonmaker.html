<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lunara JSON Generator</title>
  <style>
    :root {
      --bg-primary: #f8f9fa;
      --bg-secondary: #e9ecef;
      --text-primary: #212529;
      --text-secondary: #495057;
      --accent-color: #0d6efd;
      --accent-hover: #0b5ed7;
      --border-color: #dee2e6;
      --card-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
      --input-bg: #ffffff;
      --table-header: #f1f3f5;
      --delete-color: #dc3545;
    }

    [data-theme="dark"] {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --text-primary: #f8f9fa;
      --text-secondary: #adb5bd;
      --accent-color: #0d6efd;
      --accent-hover: #3d8bfd;
      --border-color: #2d2d2d;
      --card-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.3);
      --input-bg: #2d2d2d;
      --table-header: #252525;
      --delete-color: #ff6b6b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 20px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 15px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }

    h1 {
      font-size: 1.8rem;
      color: var(--accent-color);
      font-weight: 600;
    }

    .theme-toggle {
      background: var(--bg-secondary);
      border: none;
      border-radius: 50px;
      padding: 8px 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      color: var(--text-primary);
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: var(--border-color);
    }

    .card {
      background: var(--bg-secondary);
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
    }

    .card-title {
      font-size: 1.2rem;
      margin-bottom: 20px;
      color: var(--accent-color);
      font-weight: 500;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-primary);
    }

    input, button, select {
      width: 100%;
      padding: 12px 15px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      background-color: var(--input-bg);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
    }

    button {
      background-color: var(--accent-color);
      color: white;
      font-weight: 500;
      cursor: pointer;
      border: none;
      margin-top: 10px;
    }

    button:hover {
      background-color: var(--accent-hover);
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .btn-group button {
      flex: 1;
    }

    #searchResults {
      position: absolute;
      width: calc(100% - 30px);
      max-height: 300px;
      overflow-y: auto;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      margin-top: 5px;
      z-index: 100;
      box-shadow: var(--card-shadow);
      display: none;
    }

    .result-item {
      padding: 12px 15px;
      cursor: pointer;
      transition: background-color 0.2s;
      border-bottom: 1px solid var(--border-color);
    }

    .result-item:hover {
      background-color: var(--border-color);
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .selected-item {
      margin-top: 15px;
      font-weight: 500;
    }

    .selected-item span {
      color: var(--accent-color);
      font-weight: 600;
    }

    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }

    .input-col {
      flex: 1;
      min-width: 150px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 0.95rem;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    th {
      background-color: var(--table-header);
      font-weight: 600;
      position: sticky;
      top: 0;
    }

    tr:hover {
      background-color: var(--border-color);
    }

    .delete-btn {
      background: none;
      border: none;
      color: var(--delete-color);
      cursor: pointer;
      font-size: 1.1rem;
      padding: 5px;
    }

    .delete-btn:hover {
      opacity: 0.8;
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 10px;
      }
      
      .card {
        padding: 20px;
      }
      
      .input-col {
        min-width: 100%;
      }
      
      table {
        font-size: 0.85rem;
      }
      
      th, td {
        padding: 8px 10px;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.4s ease forwards;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Lunara Inventory Generator</h1>
      <button class="theme-toggle" id="themeToggle">
        <span id="themeIcon">🌙</span>
        <span id="themeText">Dark Mode</span>
      </button>
    </header>

    <div class="card fade-in">
      <h2 class="card-title">Item Selection</h2>
      <div class="form-group">
        <label for="searchInput">Search Items</label>
        <input type="text" id="searchInput" placeholder="Start typing to search items..." autocomplete="off">
        <div id="searchResults"></div>
        <div class="selected-item">
          Selected Item ID: <span id="selectedItemID">None</span>
        </div>
      </div>
    </div>

    <div class="card fade-in">
      <h2 class="card-title">Item Properties</h2>
      <div class="input-row">
        <div class="input-col">
          <label for="hue">Hue (0–210)</label>
          <input type="number" id="hue" value="0" min="0" max="210">
        </div>
        <div class="input-col">
          <label for="saturation">Saturation (0–120)</label>
          <input type="number" id="saturation" value="0" min="0" max="120">
        </div>
        <div class="input-col">
          <label for="scale">Scale (−128 to 127)</label>
          <input type="number" id="scale" value="-100" min="-128" max="127">
        </div>
        <div class="input-col">
          <label for="amount">Amount</label>
          <input type="number" id="amount" value="1" min="1" max="500">
        </div>
      </div>
      <div class="btn-group">
        <button onclick="addItem()">Add Item</button>
        <button onclick="generateJSON()">Generate JSON</button>
      </div>
    </div>

    <div class="card fade-in">
      <h2 class="card-title">Inventory Items</h2>
      <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th>Item ID</th>
              <th>Hue</th>
              <th>Saturation</th>
              <th>Scale</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Theme toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

    // Set initial theme based on system preference
    if (prefersDarkScheme.matches) {
      document.documentElement.setAttribute('data-theme', 'dark');
      themeIcon.textContent = '☀️';
      themeText.textContent = 'Light Mode';
    }

    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      if (currentTheme === 'dark') {
        document.documentElement.removeAttribute('data-theme');
        themeIcon.textContent = '🌙';
        themeText.textContent = 'Dark Mode';
      } else {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeIcon.textContent = '☀️';
        themeText.textContent = 'Light Mode';
      }
    });

    // Application logic
    const items = [];
    let econItems = [];
    let selectedItemID = null;

    fetch('gamedata/econ_gameplay_items.json')
      .then(res => res.json())
      .then(data => {
        econItems = data.map(i => ({ id: i.id, name: i.name }));
      })
      .catch(err => {
        console.error(err);
        alert("Failed to load item list. Make sure gamedata/econ_gameplay_items.json exists.");
      });

    function searchItems() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      if (query.length < 2) {
        document.getElementById('searchResults').style.display = 'none';
        return;
      }

      const results = econItems.filter(i => 
        i.name.toLowerCase().includes(query) || 
        i.id.toLowerCase().includes(query)
      ).slice(0, 50); // Limit to 50 results for performance

      const container = document.getElementById('searchResults');
      container.innerHTML = '';

      if (results.length === 0) {
        const noResults = document.createElement('div');
        noResults.className = 'result-item';
        noResults.textContent = 'No items found';
        container.appendChild(noResults);
      } else {
        results.forEach(item => {
          const div = document.createElement('div');
          div.className = 'result-item';
          div.innerHTML = `<strong>${item.name}</strong><br><small>${item.id}</small>`;
          div.onclick = () => selectItem(item);
          container.appendChild(div);
        });
      }

      container.style.display = 'block';
    }

    function selectItem(item) {
      selectedItemID = item.id;
      document.getElementById('selectedItemID').textContent = item.id;
      document.getElementById('searchInput').value = item.name;
      document.getElementById('searchResults').style.display = 'none';
    }

    // Close search results when clicking outside
    document.addEventListener('click', (e) => {
      if (e.target.id !== 'searchInput') {
        document.getElementById('searchResults').style.display = 'none';
      }
    });

    function addItem() {
      if (!selectedItemID) {
        alert("Please select an item first.");
        return;
      }

      const colorHue = Math.min(210, Math.max(0, parseInt(document.getElementById('hue').value, 10)));
      const colorSaturation = Math.min(120, Math.max(0, parseInt(document.getElementById('saturation').value, 10)));
      const scaleModifier = Math.min(127, Math.max(-128, parseInt(document.getElementById('scale').value, 10)));
      const amount = Math.max(1, parseInt(document.getElementById('amount').value, 10));

      for (let i = 0; i < amount; i++) {
        items.push({
          itemID: selectedItemID,
          colorHue,
          colorSaturation,
          scaleModifier
        });
      }

      updateTable();
    }

    function updateTable() {
      const table = document.getElementById('tableBody');
      table.innerHTML = '';
      
      if (items.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="5" style="text-align: center;">No items added yet</td>`;
        table.appendChild(row);
        return;
      }

      items.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.itemID}</td>
          <td>${item.colorHue}</td>
          <td>${item.colorSaturation}</td>
          <td>${item.scaleModifier}</td>
          <td><button class="delete-btn" onclick="deleteItem(${index})" title="Delete item">🗑️</button></td>
        `;
        table.appendChild(row);
      });
    }

    function deleteItem(index) {
      if (confirm("Are you sure you want to remove this item?")) {
        items.splice(index, 1);
        updateTable();
      }
    }

    function generateJSON() {
      if (items.length === 0) {
        alert("Please add at least one item before generating JSON.");
        return;
      }

      const structuredItems = {
        objects: [
          {
            collection: "user_inventory",
            key: "stash",
            permission_read: 1,
            permission_write: 1,
            value: JSON.stringify({
              version: 1,
              items: [
                {
                  itemID: "item_backpack_large_base",
                  children: items
                }
              ]
            })
          }
        ]
      };

      const blob = new Blob([JSON.stringify(structuredItems, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "custom_inventory.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Initialize table with empty state
    updateTable();
  </script>
</body>
</html>
